openapi: 3.1.0
info:
  title: Plant Database API with Photo Logging
  description: |
    Comprehensive plant database API with full CRUD operations for plant management PLUS plant health logging with photo storage.
    Now includes two-step photo upload process for both adding new plants and updating existing plants.
  version: 2.1.0
servers:
  - url: https://dev-plant-database-api.onrender.com
    description: Development server

paths:
  # =============================================
  # EXISTING PLANT MANAGEMENT OPERATIONS
  # =============================================
  
  /api/plants:
    get:
      operationId: searchPlants
      summary: Search or list all plants
      description: Search for plants by name, description, or location. If no query is provided, returns paginated plants.
      security: []
      parameters:
        - name: q
          in: query
          description: Search query to find plants by name, description, or location
          required: false
          schema:
            type: string
            example: "tomato"
        - name: limit
          in: query
          description: Maximum number of plants to return (default 20)
          required: false
          schema:
            type: integer
            default: 20
        - name: offset
          in: query
          description: Number of plants to skip for pagination (default 0)
          required: false
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Paginated list of plants matching the search criteria
          content:
            application/json:
              schema:
                type: object
                properties:
                  plants:
                    type: array
                    items:
                      $ref: '#/components/schemas/Plant'
                  total:
                    type: integer
                    description: Total number of plants in database
                  count:
                    type: integer
                    description: Number of plants in this response
                  offset:
                    type: integer
                    description: Number of plants skipped
                  limit:
                    type: integer
                    description: Maximum plants per page

    post:
      operationId: addPlant
      summary: Add a new plant to the database
      description: |
        Add a new plant with comprehensive field support. Only Plant Name is required.
        
        Photo Upload:
        1. Create plant record
        2. Use upload URL from response
        3. Add photo within 24 hours
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlantInput'
            examples:
              minimal:
                summary: Minimal plant addition
                value:
                  Plant Name: "Basil"
                  Location: "Herb Garden"
              comprehensive:
                summary: Comprehensive plant addition
                value:
                  Plant Name: "Japanese Maple"
                  Description: "Beautiful ornamental tree with stunning fall colors"
                  Location: "Front Yard"
                  Light Requirements: "Partial Shade to Full Sun"
                  Frost Tolerance: "Hardy to -15Â°C (zones 5-9)"
                  Watering Needs: "Regular watering, drought tolerant once established"
                  Soil Preferences: "Well-draining, slightly acidic soil"
                  Pruning Instructions: "Prune in late winter, remove dead branches"
                  Mulching Needs: "3-inch layer of organic mulch"
                  Fertilizing Schedule: "Feed in early spring with balanced fertilizer"
                  Winterizing Instructions: "Protect young trees from harsh winds"
                  Spacing Requirements: "Plant 6-8 feet apart"
                  Care Notes: "Avoid wet feet, provide wind protection"
      responses:
        '201':
          description: Plant added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Added Basil to garden"
                  upload_url:
                    type: string
                    description: URL for uploading a photo of the plant
                    example: "https://dev-plant-database-api.onrender.com/upload/plant/abc123xyz"
                  upload_instructions:
                    type: string
                    description: Instructions for using the upload URL
                    example: "To add a photo of your plant, visit: https://dev-plant-database-api.onrender.com/upload/plant/abc123xyz"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - missing or invalid API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/plants/{id_or_name}:
    get:
      operationId: getPlant
      summary: Get a specific plant by ID or name
      description: Retrieve detailed information about a specific plant using either its ID or exact name.
      security: []
      parameters:
        - name: id_or_name
          in: path
          required: true
          description: Plant ID or exact plant name
          schema:
            type: string
            example: "Tomato"
      responses:
        '200':
          description: Plant details
          content:
            application/json:
              schema:
                type: object
                properties:
                  plant:
                    $ref: '#/components/schemas/Plant'
        '404':
          description: Plant not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      operationId: updatePlant
      summary: Update an existing plant
      description: |
        Update specific fields of an existing plant. Only provided fields will be updated.
        
        Photo Upload:
        1. Update plant record
        2. Use upload URL from response
        3. Add photo within 24 hours
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id_or_name
          in: path
          required: true
          description: Plant ID or exact plant name to update
          schema:
            type: string
            example: "Tomato"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlantUpdate'
            examples:
              care_update:
                summary: Update care instructions
                value:
                  Watering Needs: "Water deeply twice per week"
                  Care Notes: "Mulch heavily during summer heat"
              description_update:
                summary: Update description and location
                value:
                  Description: "Updated plant description"
                  Location: "Moved to back garden"
      responses:
        '200':
          description: Plant updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Updated Tomato"
                  upload_url:
                    type: string
                    description: URL for uploading a new photo of the plant
                    example: "https://dev-plant-database-api.onrender.com/upload/plant/abc123xyz"
                  upload_instructions:
                    type: string
                    description: Instructions for using the upload URL
                    example: "To update the plant's photo, visit: https://dev-plant-database-api.onrender.com/upload/plant/abc123xyz"
        '400':
          description: Validation error or plant not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - missing or invalid API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # =============================================
  # PLANT PHOTO UPLOAD OPERATIONS
  # =============================================

  /upload/plant/{token}:
    get:
      operationId: getPlantUploadPage
      summary: Get photo upload page for a plant
      description: |
        Display a user-friendly upload page for adding or updating a plant's photo.
        This endpoint uses the upload token provided when creating or updating plants.
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
          description: Upload token provided when creating or updating the plant
          example: "abc123xyz"
      responses:
        '200':
          description: Upload page displayed successfully
          content:
            text/html:
              schema:
                type: string
                description: HTML upload page with mobile camera and gallery support
        '400':
          description: Invalid token type
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "This token is not for plant photo uploads"
        '401':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid or expired upload token"

    post:
      operationId: uploadPlantPhoto
      summary: Upload a photo for a plant
      description: |
        Upload a photo for a plant using a secure upload token.
        This endpoint is used as part of the two-step photo upload process when adding or updating plants.
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
          description: Upload token provided when creating or updating the plant
          example: "abc123xyz"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Photo file to upload (JPG, PNG, WebP, GIF, HEIC, HEIF)
      responses:
        '200':
          description: Photo uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Photo uploaded successfully to plant: Japanese Maple"
                  plant_id:
                    type: string
                    example: "PLANT-123"
                  plant_name:
                    type: string
                    example: "Japanese Maple"
                  photo_upload:
                    type: object
                    properties:
                      photo_url:
                        type: string
                        description: Public URL of the uploaded photo
                      filename:
                        type: string
                        description: Name of the uploaded file
                      upload_time:
                        type: string
                        description: When the photo was uploaded
                      file_size:
                        type: string
                        description: Size of the uploaded file
                  plant_update:
                    type: object
                    properties:
                      updated:
                        type: boolean
                        description: Whether the plant record was updated
                      message:
                        type: string
                        description: Update status message
        '400':
          description: Invalid request or file
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "No photo file provided. Please select a photo to upload."
        '401':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Invalid or expired upload token"

  /api/upload/info/{token}:
    get:
      operationId: getUploadTokenInfo
      summary: Get information about an upload token
      description: |
        Get information about an upload token, including the associated plant name and operation type.
        Used by the upload page to display relevant information to the user.
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
          description: Upload token to get information about
          example: "abc123xyz"
      responses:
        '200':
          description: Token information retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  plant_name:
                    type: string
                    example: "Japanese Maple"
                  plant_id:
                    type: string
                    example: "PLANT-123"
                  operation:
                    type: string
                    enum: [add, update]
                    example: "add"
                  token_type:
                    type: string
                    enum: [plant_upload, log_upload]
                    example: "plant_upload"
        '401':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Invalid or expired upload token"

  # =============================================
  # NEW PLANT LOGGING OPERATIONS
  # =============================================

  /upload/{token}:
    get:
      operationId: getUploadPage
      summary: Get photo upload page for a specific log entry
      description: |
        Display a user-friendly upload page for adding photos to an existing log entry.
        This endpoint uses the upload token provided when creating log entries.
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
          description: Upload token provided when the log entry was created
          example: "abc123xyz"
      responses:
        '200':
          description: Upload page displayed successfully
          content:
            text/html:
              schema:
                type: string
                description: HTML upload page with drag-drop functionality
        '400':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid or expired upload token"
        '404':
          description: Token not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Upload token not found"
      security: []
    
    post:
      operationId: uploadPhotoToLog
      summary: Upload photo to existing log entry using token
      description: |
        Upload a photo to an existing log entry using the secure upload token.
        This completes the two-step process: 1) Create log entry, 2) Upload photo.
        If the associated plant doesn't have a photo, it will also be updated with this photo.
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
          description: Upload token provided when the log entry was created
          example: "abc123xyz"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Photo file to upload (JPG, PNG, WebP, GIF)
      responses:
        '200':
          description: Photo uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Photo uploaded successfully to Tropical Hibiscus log entry"
                  log_id:
                    type: string
                    example: "LOG-20240117-605"
                  plant_name:
                    type: string
                    example: "Tropical Hibiscus"
                  photo_upload:
                    type: object
                    properties:
                      filename:
                        type: string
                        example: "plant-log/Tropical_Hibiscus_20240117_150326_5ab5d577.jpg"
                      photo_url:
                        type: string
                        example: "https://storage.googleapis.com/plant-database-photos/plant-log/Tropical_Hibiscus_20240117_150326_5ab5d577.jpg"
                      file_size:
                        type: integer
                        example: 2048
                      upload_time:
                        type: string
                        example: "2025-01-17T15:03:27.119379"
                  log_update:
                    type: object
                    properties:
                      updated:
                        type: boolean
                        example: true
                      message:
                        type: string
                        example: "Photo URLs updated for log entry LOG-20240117-605"
                  plant_update:
                    type: object
                    description: Information about plant photo update (if applicable)
                    properties:
                      updated:
                        type: boolean
                        example: true
                        description: Whether the plant's photo was updated
                      message:
                        type: string
                        example: "Plant photo updated with new image"
                        description: Status message about plant photo update
        '400':
          description: Invalid token, file, or upload error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Invalid file format or token expired"
        '500':
          description: Server error during upload
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Failed to upload photo to storage"
      security: []

  /api/enhance-analysis:
    post:
      operationId: enhanceAnalysis
      summary: Enhance plant analysis with database knowledge
      description: Enhance ChatGPT's image analysis with personalized care instructions and database matches
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                gpt_analysis:
                  type: string
                plant_identification:
                  type: string  
                user_question:
                  type: string
                location:
                  type: string
                analysis_type:
                  type: string
                  enum: [health_assessment, identification, general_care]
              required: [gpt_analysis, plant_identification]
      responses:
        '200':
          description: Enhanced analysis response
        '400':
          description: Invalid request
      security:
        - ApiKeyAuth: []

  /api/analyze-plant:
    post:
      operationId: analyzeAndLogPlant
      summary: Get plant advice or analyze photos (photos are always optional)
      description: |
        Get plant care advice, health assessment, or analyze photos. Photos are COMPLETELY OPTIONAL. 
        Use JSON format for text-based advice (recommended for ChatGPT). 
        Use multipart only when you actually have a photo to upload.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                plant_name:
                  type: string
                  description: Name of the plant (required for advice)
                  example: "Red Sister"
                user_notes:
                  type: string
                  description: Questions, concerns, or observations about the plant
                  example: "What plants are in my database? How often should I water?"
                location:
                  type: string
                  description: Location where the plant issue is occurring (garden area, room, greenhouse, etc.)
                  example: "Living room windowsill"
                analysis_type:
                  type: string
                  enum: [health_assessment, identification, general_care, follow_up]
                  default: general_care
                  description: Type of advice being requested
                gpt_analysis:
                  type: string
                  description: Optional ChatGPT image analysis text for enhanced processing
                  example: "This appears to be a tomato plant with yellowing leaves..."
            examples:
              plant_advice:
                summary: Request plant care advice (text only, no photo needed)
                value:
                  plant_name: "Red Sister"
                  user_notes: "What plants are there? How should I care for them?"
                  location: "Garden"
                  analysis_type: "general_care"
              health_assessment:
                summary: Ask about plant health (text only, no photo needed)
                value:
                  plant_name: "Tomato"
                  user_notes: "Leaves are wilting, what should I do?"
                  location: "Vegetable garden"
                  analysis_type: "health_assessment"
              general_questions:
                summary: Ask general plant questions without photos
                value:
                  plant_name: "Tropical Hibiscus"
                  user_notes: "Flower appears wilted and crinkled despite moist conditions. What should I do?"
                  location: "Front porch"
                  analysis_type: "health_assessment"
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Plant photo to analyze (JPG, PNG, WebP, GIF) - COMPLETELY OPTIONAL, only use if you have an actual photo
                plant_name:
                  type: string
                  description: Name of the plant
                  example: "Tomato Plant #1"
                user_notes:
                  type: string
                  description: Questions, concerns, or observations about the plant
                  example: "How often should I water? Noticed yellowing leaves yesterday"
                location:
                  type: string
                  description: Location where the plant issue is occurring (garden area, room, greenhouse, etc.)
                  example: "Front garden bed 2"
                analysis_type:
                  type: string
                  enum: [health_assessment, identification, general_care, follow_up]
                  default: general_care
                  description: Type of analysis or advice being requested
      responses:
        '200':
          description: Analysis complete or plant advice provided
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  analysis:
                    type: object
                    properties:
                      diagnosis:
                        type: string
                        description: Plant health diagnosis or care advice
                      treatment:
                        type: string
                        description: Recommended treatment or care instructions
                      confidence:
                        type: number
                        description: Analysis confidence score (0-1)
                      advice_type:
                        type: string
                        enum: [photo_analysis, general_advice]
                        description: Whether this was photo analysis or general advice
                      identified_plant:
                        type: string
                        description: Plant species/name identified from photo (when different from user input)
                        example: "Hibiscus rosa-sinensis"
                      photo_processed:
                        type: boolean
                        description: Whether a photo was analyzed
                      photo_stored:
                        type: boolean
                        description: Whether the photo was stored in cloud storage
                      note:
                        type: string
                        description: Explanation of what processing occurred
                        example: "Photo was analyzed but not stored (ChatGPT mode)"
                  image_upload:
                    type: object
                    description: Only present when photo was uploaded
                    properties:
                      photo_url:
                        type: string
                        description: Public URL of the uploaded photo
                      filename:
                        type: string
                        description: Name of the uploaded file
                      upload_time:
                        type: string
                        description: When the photo was uploaded
                  log_entry:
                    type: object
                    description: Only present when photo was uploaded and log created
                    properties:
                      log_id:
                        type: string
                        description: Unique identifier for the log entry
                      plant_name:
                        type: string
                        description: Plant name used for the log entry
                      created:
                        type: boolean
                        description: Whether the log entry was successfully saved
                      upload_url:
                        type: string
                        description: Secure upload link for adding photos to this log entry
                        example: "https://dev-plant-database-api.onrender.com/upload/abc123xyz"
                      upload_instructions:
                        type: string
                        description: User-friendly instructions for photo upload
                        example: "To add a photo to this log entry, visit: https://dev-plant-database-api.onrender.com/upload/abc123xyz"
                  suggestions:
                    type: object
                    description: Plant suggestions when plant not found
                    properties:
                      plant_not_found:
                        type: boolean
                        description: Whether the plant was found in database
                      identified_plant:
                        type: string
                        description: Plant name identified from photo
                        example: "Tropical Hibiscus"
                      similar_plants:
                        type: array
                        items:
                          type: string
                        description: Existing plants that might match
                      create_new_plant:
                        type: boolean
                        description: Option to create new plant record
                      message:
                        type: string
                        description: Helpful message about the identification and next steps
                        example: "I identified this as 'Tropical Hibiscus' but it's not in your plant database."
      security:
        - ApiKeyAuth: []

  /api/plants/log:
    post:
      operationId: createPlantLog
      summary: Create manual plant log entry with optional photo
      description: |
        Create a plant log entry manually. Useful for follow-up entries or 
        when you want to add notes without AI analysis.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - plant_name
              properties:
                plant_name:
                  type: string
                  description: Name of the plant (must exist in database)
                  example: "Tomato Plant #1"
                file:
                  type: string
                  format: binary
                  description: Optional plant photo
                log_title:
                  type: string
                  description: Title for this log entry
                  example: "Weekly health check"
                location:
                  type: string
                  description: Location where the plant issue is occurring
                  example: "Greenhouse shelf 3"
                user_notes:
                  type: string
                  description: Observations and notes
                diagnosis:
                  type: string
                  description: Plant health assessment
                treatment:
                  type: string
                  description: Treatment or care recommendations
                follow_up_required:
                  type: boolean
                  description: Whether follow-up is needed
                follow_up_date:
                  type: string
                  format: date
                  description: When to check again (YYYY-MM-DD)
      responses:
        '200':
          description: Log entry created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  log_id:
                    type: string
                  message:
                    type: string
      security:
        - ApiKeyAuth: []

  /api/plants/log/simple:
    post:
      operationId: createPlantLogSimple
      summary: Create plant log entry with JSON (ChatGPT-friendly)
      description: |
        Create a plant log entry using simple JSON format instead of multipart form data.
        Ideal for ChatGPT and AI systems that have restrictions with file uploads.
        This endpoint focuses on text-based logging without photo upload.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - plant_name
              properties:
                plant_name:
                  type: string
                  description: Name of the plant (must exist in database)
                  example: "Tomato Plant #1"
                log_title:
                  type: string
                  description: Title for this log entry
                  example: "Weekly health check"
                location:
                  type: string
                  description: Location where the plant issue is occurring
                  example: "Back patio planter box"
                user_notes:
                  type: string
                  description: Observations and notes
                  example: "Noticed yellowing on lower leaves"
                diagnosis:
                  type: string
                  description: Plant health assessment
                  example: "Minor nitrogen deficiency indicated by yellowing"
                treatment:
                  type: string
                  description: Treatment or care recommendations
                  example: "Apply balanced fertilizer and increase watering"
                symptoms:
                  type: string
                  description: Symptoms observed
                  example: "Yellow leaf edges, slight wilting"
                analysis_type:
                  type: string
                  enum: [health_assessment, identification, general_care, follow_up]
                  default: health_assessment
                  description: Type of analysis
                confidence_score:
                  type: number
                  minimum: 0.0
                  maximum: 1.0
                  default: 0.8
                  description: Confidence level of the assessment
                follow_up_required:
                  type: boolean
                  default: false
                  description: Whether follow-up is needed
                follow_up_date:
                  type: string
                  format: date
                  description: When to check again (YYYY-MM-DD)
                  example: "2024-01-22"
            examples:
              health_check:
                summary: Health assessment log
                value:
                  plant_name: "Tomato Plant #1"
                  log_title: "Weekly Health Check"
                  location: "Vegetable garden row 2"
                  user_notes: "Noticed yellowing on lower leaves yesterday"
                  diagnosis: "Minor nitrogen deficiency indicated by yellowing"
                  treatment: "Apply balanced fertilizer and increase watering frequency"
                  symptoms: "Yellow leaf edges, slight wilting in afternoon"
                  follow_up_required: true
                  follow_up_date: "2024-01-22"
      responses:
        '201':
          description: Log entry created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  log_id:
                    type: string
                    example: "LOG-20240115-001"
                  plant_name:
                    type: string
                    example: "Tomato Plant #1"
                  message:
                    type: string
                    example: "Log entry created successfully"
                  upload_url:
                    type: string
                    example: "https://dev-plant-database-api.onrender.com/upload/abc123xyz"
                    description: "Secure upload link for adding photos to this log entry"
                  upload_instructions:
                    type: string
                    example: "To add a photo to this log entry, visit: https://dev-plant-database-api.onrender.com/upload/abc123xyz"
                    description: "User-friendly instructions for photo upload"
                  log_entry:
                    type: object
                    description: Complete log entry data
              examples:
                with_upload_link:
                  summary: Successful log creation with upload link
                  value:
                    success: true
                    log_id: "LOG-20240115-001"
                    plant_name: "Tomato Plant #1"
                    message: "Log entry created successfully"
                    upload_url: "https://dev-plant-database-api.onrender.com/upload/abc123xyz"
                    upload_instructions: "To add a photo to this log entry, visit: https://dev-plant-database-api.onrender.com/upload/abc123xyz"
        '400':
          description: Validation error or plant not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Plant not found in database"
                  suggestions:
                    type: array
                    items:
                      type: string
                    description: Similar plant names if plant not found
        '401':
          description: Unauthorized - missing or invalid API key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - ApiKeyAuth: []

  /api/plants/{plant_name}/log:
    get:
      operationId: getPlantLogHistory
      summary: Get log history for a specific plant
      description: Retrieve all log entries for a plant in chronological order
      parameters:
        - name: plant_name
          in: path
          required: true
          schema:
            type: string
          description: Name of the plant
          example: "Tomato Plant #1"
        - name: format
          in: query
          schema:
            type: string
            enum: [standard, journal]
            default: standard
          description: Response format (standard JSON or human-readable journal)
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          description: Maximum number of entries to return
      responses:
        '200':
          description: Plant log history retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  plant_name:
                    type: string
                  plant_id:
                    type: string
                  total_entries:
                    type: integer
                  log_entries:
                    type: array
                    items:
                      type: object
                      properties:
                        log_id:
                          type: string
                        log_date:
                          type: string
                        log_title:
                          type: string
                        diagnosis:
                          type: string
                        treatment:
                          type: string
                        photo_url:
                          type: string
                        user_notes:
                          type: string
                        confidence:
                          type: number

  /api/plants/log/search:
    get:
      operationId: searchPlantLogs
      summary: Search across all plant logs
      description: Search plant logs by various criteria
      parameters:
        - name: plant_name
          in: query
          schema:
            type: string
          description: Filter by specific plant name
        - name: q
          in: query
          schema:
            type: string
          description: General search term (searches diagnosis, symptoms, notes)
        - name: symptoms
          in: query
          schema:
            type: string
          description: Search by symptoms (comma-separated)
          example: "yellowing,wilting"
        - name: date_from
          in: query
          schema:
            type: string
            format: date
          description: Start date for date range search (YYYY-MM-DD)
        - name: date_to
          in: query
          schema:
            type: string
            format: date
          description: End date for date range search (YYYY-MM-DD)
        - name: format
          in: query
          schema:
            type: string
            enum: [standard, journal]
            default: standard
          description: Response format
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_matches:
                    type: integer
                  search_query:
                    type: string
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        log_id:
                          type: string
                        plant_name:
                          type: string
                        log_date:
                          type: string
                        matched_content:
                          type: string
                        photo_url:
                          type: string
                        relevance_score:
                          type: number

  # =============================================
  # PHASE 1: LOCATIONS & CONTAINERS INTEGRATION
  # =============================================

  /api/plants/{plant_id}/location-context:
    get:
      operationId: getPlantLocationContext
      summary: Get comprehensive location and container context for a specific plant
      description: |
        Returns all containers for the plant with their location details and care recommendations.
        Use this when you need precise, location-aware care advice for a specific plant.
      security: []
      parameters:
        - name: plant_id
          in: path
          required: true
          schema:
            type: string
          description: The plant ID to get context for
      responses:
        '200':
          description: Plant location context successfully retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  plant_id:
                    type: string
                  contexts:
                    type: array
                    items:
                      type: object
                      properties:
                        container:
                          type: object
                          properties:
                            container_id:
                              type: string
                            plant_id:
                              type: string
                            location_id:
                              type: string
                            container_type:
                              type: string
                            container_size:
                              type: string
                            container_material:
                              type: string
                        location:
                          type: object
                          properties:
                            location_id:
                              type: string
                            location_name:
                              type: string
                            morning_sun_hours:
                              type: integer
                            afternoon_sun_hours:
                              type: integer
                            evening_sun_hours:
                              type: integer
                            total_sun_hours:
                              type: integer
                            shade_pattern:
                              type: string
                            microclimate_conditions:
                              type: string
                        context:
                          type: object
                          properties:
                            placement_description:
                              type: string
                            sun_exposure_summary:
                              type: string
                            care_complexity:
                              type: string
                            priority_considerations:
                              type: array
                              items:
                                type: string
                  total_contexts:
                    type: integer
        '404':
          description: Plant not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/locations/{location_id}/care-profile:
    get:
      operationId: getLocationCareProfile
      summary: Get comprehensive care profile for a specific location
      description: |
        Returns sun exposure analysis, watering strategy, and general recommendations for a location.
        Use this when you need location-specific care strategies.
      security: []
      parameters:
        - name: location_id
          in: path
          required: true
          schema:
            type: string
          description: The location ID to get care profile for
      responses:
        '200':
          description: Location care profile successfully retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  location_id:
                    type: string
                  care_profile:
                    type: object
                    properties:
                      location_info:
                        type: object
                        properties:
                          location_id:
                            type: string
                          location_name:
                            type: string
                          classification:
                            type: string
                      watering_strategy:
                        type: object
                        properties:
                          primary_time:
                            type: string
                          secondary_time:
                            type: string
                          avoid_times:
                            type: array
                            items:
                              type: string
                          reasoning:
                            type: string
                      environmental_factors:
                        type: object
                        properties:
                          sun_exposure:
                            type: object
                          microclimate:
                            type: object
                      general_recommendations:
                        type: array
                        items:
                          type: string
        '404':
          description: Location not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/garden/containers/{container_id}/care-requirements:
    get:
      operationId: getContainerCareRequirements
      summary: Get specific care requirements for a container
      description: |
        Returns container details, location context, and integrated care recommendations.
        Use this when you need container-specific care guidance.
      security: []
      parameters:
        - name: container_id
          in: path
          required: true
          schema:
            type: string
          description: The container ID to get care requirements for
      responses:
        '200':
          description: Container care requirements successfully retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  container_id:
                    type: string
                  care_requirements:
                    type: object
                    properties:
                      container_info:
                        type: object
                        properties:
                          container_id:
                            type: string
                          plant_id:
                            type: string
                          type:
                            type: string
                          size:
                            type: string
                          material:
                            type: string
                      location_context:
                        type: object
                        properties:
                          location_id:
                            type: string
                          location_name:
                            type: string
                          sun_exposure:
                            type: string
                          microclimate:
                            type: string
                      care_adjustments:
                        type: object
                        properties:
                          material_considerations:
                            type: array
                            items:
                              type: string
                          size_adjustments:
                            type: array
                            items:
                              type: string
                          drainage_recommendations:
                            type: array
                            items:
                              type: string
                          temperature_management:
                            type: array
                            items:
                              type: string
                      watering_strategy:
                        type: object
                      integrated_recommendations:
                        type: array
                        items:
                          type: string
        '404':
          description: Container not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/locations/all:
    get:
      operationId: getAllLocations
      summary: Get all locations with complete metadata
      description: |
        Returns list of all locations with sun exposure and microclimate data.
        Use this when you need to understand all available locations.
      security: []
      responses:
        '200':
          description: All locations successfully retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  locations:
                    type: array
                    items:
                      type: object
                      properties:
                        location_id:
                          type: string
                        location_name:
                          type: string
                        morning_sun_hours:
                          type: integer
                        afternoon_sun_hours:
                          type: integer
                        evening_sun_hours:
                          type: integer
                        total_sun_hours:
                          type: integer
                        shade_pattern:
                          type: string
                        microclimate_conditions:
                          type: string
                  total:
                    type: integer

  /api/containers/all:
    get:
      operationId: getAllContainers
      summary: Get all containers with complete metadata
      description: |
        Returns list of all containers with plant, location, and specification data.
        Use this when you need to understand container distribution.
      security: []
      responses:
        '200':
          description: All containers successfully retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  containers:
                    type: array
                    items:
                      type: object
                      properties:
                        container_id:
                          type: string
                        plant_id:
                          type: string
                        location_id:
                          type: string
                        container_type:
                          type: string
                        container_size:
                          type: string
                        container_material:
                          type: string
                  total:
                    type: integer

  # =============================================
  # PHASE 2: ADVANCED METADATA AGGREGATION
  # =============================================

  /api/garden/location-analysis/{location_id}:
    get:
      operationId: getLocationAnalysis
      summary: Get comprehensive location analysis with container context
      description: |
        Returns comprehensive location analysis with container context and optimization suggestions.
        Use this for complete analysis of a location including all containers and recommendations.
      security: []
      parameters:
        - name: location_id
          in: path
          required: true
          schema:
            type: string
          description: The location ID to analyze
      responses:
        '200':
          description: Location analysis successfully retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  location_id:
                    type: string
                  location_profile:
                    type: object
                    properties:
                      location_data:
                        type: object
                      container_statistics:
                        type: object
                      care_intelligence:
                        type: object
                      optimization_opportunities:
                        type: array
                        items:
                          type: object
                      plant_distribution:
                        type: object
                        description: Plant distribution with plant names and container details
                        properties:
                          plant_details:
                            type: object
                            description: Detailed information for each plant including name and containers
                          multiple_container_plants:
                            type: array
                            description: Plants with multiple containers (includes plant names)
                          single_container_plants:
                            type: array  
                            description: Plants with single containers (includes plant names)
                  care_recommendations:
                    type: object
                    properties:
                      location_analysis:
                        type: object
                      watering_strategy:
                        type: object
                      plant_placement:
                        type: object
                      optimization_recommendations:
                        type: array
                        items:
                          type: object
                      care_complexity_assessment:
                        type: object
        '404':
          description: Location not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/plants/{plant_id}/context:
    get:
      operationId: getPlantContext
      summary: Get full contextual analysis for specific plant
      description: |
        Returns full contextual analysis for specific plant across all containers and locations.
        Use this for comprehensive environmental analysis for a specific plant.
      security: []
      parameters:
        - name: plant_id
          in: path
          required: true
          schema:
            type: string
          description: The plant ID to get context for
      responses:
        '200':
          description: Plant context successfully retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  plant_id:
                    type: string
                  plant_name:
                    type: string
                    description: The name of the plant
                  contexts:
                    type: array
                    items:
                      type: object
                      properties:
                        container:
                          type: object
                        location:
                          type: object
                        care_plan:
                          type: object
                        location_intelligence:
                          type: object
                        optimization_tips:
                          type: array
                          items:
                            type: object
                  total_contexts:
                    type: integer
                  message:
                    type: string
                    description: Success message with plant name
        '404':
          description: Plant not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/garden/metadata/enhanced:
    get:
      operationId: getEnhancedMetadata
      summary: Get comprehensive garden metadata with location + container intelligence
      description: |
        Returns comprehensive garden metadata with location + container intelligence.
        Use this for garden-wide analysis, statistics, and optimization insights.
      security: []
      responses:
        '200':
          description: Enhanced metadata successfully retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  enhanced_metadata:
                    type: object
                    properties:
                      garden_overview:
                        type: object
                      location_distribution:
                        type: object
                      container_intelligence:
                        type: object
                      care_complexity_analysis:
                        type: object
                      optimization_opportunities:
                        type: array
                        items:
                          type: object
                  api_version:
                    type: string
                    example: "Phase 2 - Advanced Metadata Aggregation"

  /api/garden/location-profiles:
    get:
      operationId: getAllLocationProfiles
      summary: Get all location profiles with aggregated container statistics
      description: |
        Returns all location profiles with aggregated container statistics.
        Use this for overview of all locations with their container distributions.
      security: []
      responses:
        '200':
          description: Location profiles successfully retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  location_profiles:
                    type: array
                    items:
                      type: object
                      properties:
                        location_id:
                          type: string
                        location_name:
                          type: string
                        morning_sun_hours:
                          type: integer
                        afternoon_sun_hours:
                          type: integer
                        evening_sun_hours:
                          type: integer
                        total_sun_hours:
                          type: integer
                        shade_pattern:
                          type: string
                        microclimate_conditions:
                          type: string
                        total_containers:
                          type: integer
                        unique_plants:
                          type: integer
                        container_types:
                          type: array
                          items:
                            type: string
                        container_sizes:
                          type: array
                          items:
                            type: string
                        container_materials:
                          type: array
                          items:
                            type: string
                  total_profiles:
                    type: integer

  /api/garden/care-optimization:
    get:
      operationId: getCareOptimization
      summary: Get location and container-based care optimization suggestions
      description: |
        Returns location and container-based care optimization suggestions.
        Use this for proactive recommendations and efficiency improvements.
      security: []
      responses:
        '200':
          description: Care optimization analysis successfully retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  optimization_analysis:
                    type: object
                    properties:
                      garden_wide_opportunities:
                        type: array
                        items:
                          type: object
                      care_complexity_summary:
                        type: object
                      high_priority_locations:
                        type: array
                        items:
                          type: object
                      container_upgrade_recommendations:
                        type: array
                        items:
                          type: object
                      efficiency_improvements:
                        type: array
                        items:
                          type: object
                  total_opportunities:
                    type: integer
                  high_priority_locations:
                    type: integer

  /api/weather/current:
    get:
      operationId: getCurrentWeather
      summary: Get current weather conditions in Houston
      description: |
        Get real-time weather conditions for Houston, including temperature, humidity, 
        precipitation chance, and wind speed.
      security: []
      responses:
        '200':
          description: Current weather conditions
          content:
            application/json:
              schema:
                type: object
                properties:
                  temperature:
                    type: number
                    description: Current temperature in Fahrenheit
                    example: 75.5
                  humidity:
                    type: number
                    description: Current humidity percentage
                    example: 65
                  wind_speed:
                    type: number
                    description: Wind speed in mph
                    example: 8
                  description:
                    type: string
                    description: Weather description
                    example: "Partly cloudy"
                  precipitation_chance:
                    type: number
                    description: Chance of precipitation as percentage
                    example: 30

  /api/weather/forecast:
    get:
      operationId: getWeatherForecast
      summary: Get hourly weather forecast for Houston
      description: |
        Get hourly weather forecast data for planning gardening activities.
      security: []
      parameters:
        - name: hours
          in: query
          description: Number of hours to forecast (default 24, max 48)
          required: false
          schema:
            type: integer
            default: 24
            maximum: 48
      responses:
        '200':
          description: Hourly forecast data
          content:
            application/json:
              schema:
                type: object
                properties:
                  forecast:
                    type: array
                    items:
                      type: object
                      properties:
                        time:
                          type: string
                          description: Formatted time
                          example: "2 PM"
                        temperature:
                          type: number
                          description: Temperature in Fahrenheit
                          example: 78.5
                        description:
                          type: string
                          description: Weather description
                          example: "Clear"
                        precipitation_chance:
                          type: number
                          description: Chance of precipitation as percentage
                          example: 20
                        wind_speed:
                          type: number
                          description: Wind speed in mph
                          example: 10

  /api/weather/forecast/daily:
    get:
      operationId: getDailyWeatherForecast
      summary: Get daily weather forecast
      description: Returns daily weather forecast for specified number of days (max 7 days)
      security: []
      parameters:
        - name: days
          in: query
          description: Number of days to forecast (1-7)
          required: false
          schema:
            type: integer
            default: 7
            minimum: 1
            maximum: 7
      responses:
        '200':
          description: Daily forecast data
          content:
            application/json:
              schema:
                type: object
                properties:
                  forecast:
                    type: array
                    items:
                      type: object
                      properties:
                        date:
                          type: string
                          description: Date in YYYY-MM-DD format
                        high_temp:
                          type: integer
                          description: High temperature in Fahrenheit
                        low_temp:
                          type: integer
                          description: Low temperature in Fahrenheit
                        precipitation_chance:
                          type: integer
                          description: Chance of precipitation as percentage
                        description:
                          type: string
                          description: Weather description
                        wind_speed:
                          type: integer
                          description: Wind speed in MPH

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: API key required for write operations (POST, PUT)

  schemas:
    Plant:
      type: object
      properties:
        ID:
          type: string
          description: Unique plant identifier
          example: "1"
        Plant Name:
          type: string
          description: Name of the plant
          example: "Tomato"
        Description:
          type: string
          description: Plant description
          example: "Classic garden vegetable"
        Location:
          type: string
          description: Location in garden (comma-separated for multiple)
          example: "Vegetable Garden, Greenhouse"
        Light Requirements:
          type: string
          description: Sunlight needs
          example: "Full Sun"
        Frost Tolerance:
          type: string
          description: Cold hardiness information
          example: "Not frost tolerant"
        Watering Needs:
          type: string
          description: Watering frequency and requirements
          example: "Regular watering, keep soil moist"
        Soil Preferences:
          type: string
          description: Soil type and pH requirements
          example: "Well-draining, rich soil"
        Soil pH Type:
          type: string
          description: Soil pH classification
          example: "slightly acidic"
          enum: ["high alkalinity", "medium alkalinity", "slightly alkaline", "neutral", "slightly acidic", "medium acidity", "high acidity"]
        Soil pH Range:
          type: string
          description: Specific soil pH range
          example: "6.0 - 6.5"
        Pruning Instructions:
          type: string
          description: When and how to prune
          example: "Remove suckers, prune lower leaves"
        Mulching Needs:
          type: string
          description: Mulching recommendations
          example: "2-3 inch layer around base"
        Fertilizing Schedule:
          type: string
          description: Fertilization timing and type
          example: "Every 2-3 weeks during growing season"
        Winterizing Instructions:
          type: string
          description: Winter care instructions
          example: "Harvest before first frost"
        Spacing Requirements:
          type: string
          description: Plant spacing recommendations
          example: "18-24 inches apart"
        Care Notes:
          type: string
          description: Additional care information
          example: "Support with stakes or cages"
        Photo URL:
          type: string
          description: Image URL (stored as IMAGE formula)
          example: "=IMAGE(\"https://example.com/tomato.jpg\")"
        Raw Photo URL:
          type: string
          description: Direct image URL
          example: "https://example.com/tomato.jpg"
        Last Updated:
          type: string
          description: Timestamp of last update
          example: "2024-01-15 10:30:45"

    PlantInput:
      type: object
      required:
        - Plant Name
      properties:
        Plant Name:
          type: string
          description: "REQUIRED: Name of the plant - use exactly 'Plant Name'"
          example: "Basil"
        Description:
          type: string
          description: "Plant description - use exactly 'Description'"
          example: "Aromatic herb perfect for cooking"
        Location:
          type: string
          description: "Location in garden - use exactly 'Location'"
          example: "Herb Garden"
        Light Requirements:
          type: string
          description: "Sunlight needs - use exactly 'Light Requirements'"
          example: "Full Sun to Partial Shade"
        Frost Tolerance:
          type: string
          description: "Cold hardiness - use exactly 'Frost Tolerance'"
          example: "Tender annual, no frost tolerance"
        Watering Needs:
          type: string
          description: "Watering requirements - use exactly 'Watering Needs'"
          example: "Keep soil consistently moist"
        Soil Preferences:
          type: string
          description: "Soil requirements - use exactly 'Soil Preferences'"
          example: "Well-draining, fertile soil"
        Soil pH Type:
          type: string
          description: "Soil pH classification - use exactly 'Soil pH Type'"
          example: "slightly acidic"
          enum: ["high alkalinity", "medium alkalinity", "slightly alkaline", "neutral", "slightly acidic", "medium acidity", "high acidity"]
        Soil pH Range:
          type: string
          description: "Specific soil pH range - use exactly 'Soil pH Range'"
          example: "6.0 - 6.5"
        Pruning Instructions:
          type: string
          description: "Pruning guidance - use exactly 'Pruning Instructions'"
          example: "Pinch flowers to encourage leaf growth"
        Mulching Needs:
          type: string
          description: "Mulching recommendations - use exactly 'Mulching Needs'"
          example: "Light mulch to retain moisture"
        Fertilizing Schedule:
          type: string
          description: "Fertilization plan - use exactly 'Fertilizing Schedule'"
          example: "Light fertilizer monthly"
        Winterizing Instructions:
          type: string
          description: "Winter care - use exactly 'Winterizing Instructions'"
          example: "Bring indoors or treat as annual"
        Spacing Requirements:
          type: string
          description: "Spacing needs - use exactly 'Spacing Requirements'"
          example: "12 inches apart"
        Care Notes:
          type: string
          description: "Additional care tips - use exactly 'Care Notes'"
          example: "Harvest regularly to prevent flowering"
        Photo URL:
          type: string
          description: "Image URL - use exactly 'Photo URL'"
          example: "https://example.com/basil.jpg"

    PlantUpdate:
      type: object
      description: "Partial update object - all fields are optional. CRITICAL: Use exact field names as specified below."
      properties:
        Plant Name:
          type: string
          description: "Name of the plant - use exactly 'Plant Name'"
        Description:
          type: string
          description: "Plant description - use exactly 'Description'"
        Location:
          type: string
          description: "Location in garden - use exactly 'Location'"
        Light Requirements:
          type: string
          description: "Sunlight needs - use exactly 'Light Requirements'"
        Frost Tolerance:
          type: string
          description: "Cold hardiness - use exactly 'Frost Tolerance'"
        Watering Needs:
          type: string
          description: "Watering requirements - use exactly 'Watering Needs'"
        Soil Preferences:
          type: string
          description: "Soil requirements - use exactly 'Soil Preferences'"
        Soil pH Type:
          type: string
          description: "Soil pH classification - use exactly 'Soil pH Type'"
          example: "slightly acidic"
          enum: ["high alkalinity", "medium alkalinity", "slightly alkaline", "neutral", "slightly acidic", "medium acidity", "high acidity"]
        Soil pH Range:
          type: string
          description: "Specific soil pH range - use exactly 'Soil pH Range'"
        Pruning Instructions:
          type: string
          description: "Pruning guidance - use exactly 'Pruning Instructions'"
        Mulching Needs:
          type: string
          description: "Mulching recommendations - use exactly 'Mulching Needs'"
        Fertilizing Schedule:
          type: string
          description: "Fertilization plan - use exactly 'Fertilizing Schedule'"
        Winterizing Instructions:
          type: string
          description: "Winter care - use exactly 'Winterizing Instructions'"
        Spacing Requirements:
          type: string
          description: "Spacing needs - use exactly 'Spacing Requirements'"
        Care Notes:
          type: string
          description: "Additional care tips - use exactly 'Care Notes'"
        Photo URL:
          type: string
          description: "Image URL - use exactly 'Photo URL'"

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: "Plant Name is required" 